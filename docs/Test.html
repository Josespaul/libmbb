<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>libmbb - Unit Tests
</title>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.2/cosmo/bootstrap.min.css">
<style>
body {
	padding-top: 20px;
	padding-bottom: 20px;
}
@media (min-width: 768px) {
	.container {
		max-width: 730px;
	}
}
</style>
</head>
<body>
<div class="container">
<h1>libmbb - Unit Tests</h1>

<p><a href=".."><em>libmbb</em></a> features a simple unit test framework inspired by
<a href="http://www.jera.com/techinfo/jtns/jtn002.html">MinUnit</a>.</p>

<h2>Writing unit tests</h2>

<p>A test suite is a single C file containing any number of test cases. It must </p>

<pre><code>#include &quot;mbb/test.h&quot;
</code></pre>

<p>A test case looks like this:</p>

<pre><code>#include &quot;mbb/queue.h&quot;
#include &quot;mbb/debug.h&quot;

char *test_enqueue_dequeue()
{
    int i;

    MQUE_DEFINE_STRUCT(int, 5) queue;

    MQUE_INITIALISE(&amp;queue);

    MUNT_ASSERT(MQUE_IS_EMPTY(&amp;queue));

    for (i = 1; i &lt;= 5; i++) {
        MUNT_ASSERT(!MQUE_IS_FULL(&amp;queue));
        MQUE_ENQUEUE(&amp;queue, i);
    }

    MUNT_ASSERT(MQUE_IS_FULL(&amp;queue));

    for (i = 1; i &lt;= 5; i++) {
        int head;

        MUNT_ASSERT(!MQUE_IS_EMPTY(&amp;queue));

        head = MQUE_HEAD(&amp;queue);
        MUNT_ASSERT(head == i);

        MQUE_DEQUEUE(&amp;queue);
    }

    MUNT_ASSERT(MQUE_IS_EMPTY(&amp;queue));

    return 0;
}
</code></pre>

<p>The test case function must return a string and its name must begin with
<code>test_</code>. It must return 0 if no error occured. The <code>MUNT_ASSERT(EXPRESSION)</code>
macro is used for the actual test assertions. It makes the test case function
return a string if <code>EXPRESSION</code> is false.</p>

<p>Have a look at <em>libmbb</em>&#39;s own <a href="../tests/">tests</a> as an example.</p>

<h2>Compiling unit tests</h2>

<p>The <code>munt_main</code> tool is used to generate a main function for a test suite,
printing it to <code>stdout</code>. Calling </p>

<pre><code>munt_main test_suite.c &gt; test_suite_main.c
</code></pre>

<p>pipes the automatically generated main function to <code>test_suite_main.c</code>. </p>

<p>This source code can be compiled to an executable which exits returning
<code>EXIT_SUCCESS</code> or <code>EXIT_FAILURE</code> depending on whether the test suite failed.</p>

<h2>Running unit tests</h2>

<p>The output of the automatically generated test program looks like this:</p>

<pre><code>tests/test_queue

Test suite &#39;test_queue&#39;:

### test_enqueue_dequeue ###
Assertion passed (013): MQUE_IS_EMPTY(&amp;queue)
Assertion passed (016): !MQUE_IS_FULL(&amp;queue)
Assertion passed (016): !MQUE_IS_FULL(&amp;queue)
Assertion passed (016): !MQUE_IS_FULL(&amp;queue)
Assertion passed (016): !MQUE_IS_FULL(&amp;queue)
Assertion passed (016): !MQUE_IS_FULL(&amp;queue)
Assertion passed (020): MQUE_IS_FULL(&amp;queue)
Assertion passed (025): !MQUE_IS_EMPTY(&amp;queue)
Assertion passed (028): head == i
Assertion passed (025): !MQUE_IS_EMPTY(&amp;queue)
Assertion passed (028): head == i
Assertion passed (025): !MQUE_IS_EMPTY(&amp;queue)
Assertion passed (028): head == i
Assertion passed (025): !MQUE_IS_EMPTY(&amp;queue)
Assertion passed (028): head == i
Assertion passed (025): !MQUE_IS_EMPTY(&amp;queue)
Assertion passed (028): head == i
Assertion passed (033): MQUE_IS_EMPTY(&amp;queue)
### passed ###

Test suite &#39;test_queue&#39; passed (1 test run)
</code></pre>

<p class="text-muted text-center" style="margin-top: 40px;">
This website was rendered automatically from <em>libmbb</em>'s Markdown documentation.
</p>
</div>
</body>
</html>
